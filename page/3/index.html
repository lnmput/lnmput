<!doctype html>



  


<html class="theme-next muse use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="一个专注记录外贸网站开发技术栈的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="杨子鳄鱼 ● 外贸自建站">
<meta property="og:url" content="https://swoole.app/page/3/index.html">
<meta property="og:site_name" content="杨子鳄鱼 ● 外贸自建站">
<meta property="og:description" content="一个专注记录外贸网站开发技术栈的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="杨子鳄鱼 ● 外贸自建站">
<meta name="twitter:description" content="一个专注记录外贸网站开发技术栈的个人博客">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 杨子鳄鱼 ● 外贸自建站 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>
    <a target="_blank" href="https://github.com/lnmput"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">杨子鳄鱼 ● 外贸自建站</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">十年外贸建站经验，专注外贸独立站建设，欢迎咨询</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-read">
          <a href="/read" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br>
            
            读书
          </a>
        </li>
      
        
        <li class="menu-item menu-item-translate">
          <a href="/tags/translate" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-file"></i> <br>
            
            翻译
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            简历
          </a>
        </li>
      
        
        <li class="menu-item menu-item-site">
          <a href="/site" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-thumbs-up"></i> <br>
            
            外贸站
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/23/golang定义栈的数据结构/" itemprop="url">
                  golang定义栈的数据结构
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-03-23T21:03:44+08:00" content="2020-03-23">
              2020-03-23
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center"><br>东风夜放花千树，更吹落，星如雨。<br></blockquote>

<h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p>栈是一种操作受限制的线性表，将允许进行插入、删除的一端称为栈顶，另一端称为栈底。看到这里你可能会觉得有点绕，其实数据结构很多的定义都很抽象，这是很正常的，下面我将类比一个生活中的常见实例帮助大家理解。</p>
<p>我们在日常生活中洗盘子的时候，摞起来的盘子就是一个典型的栈结构。不管取还是放，总是要放在盘子堆的最上面操作。如果你想从一堆盘子的中间强行取一个盘子，那就有可能酿成大祸。</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>我们在日常生活中，一摞盘子肯定有很多个而且是连续的，所以我们首先需要一个切片，并且我们日常生活中的盘子是不能无限的摞的，这点在计算机里也是同样的，计算机里也会有 Stack Overflow 的问题。 所以我们还需要一个容量的限制元素。 并且我们还需要频繁的对栈顶元素进行操作，所以我们还需要一个标记位 top 来标记栈顶元素的索引。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> *<span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">int</span>,size),</span><br><span class="line">        <span class="comment">// 栈顶指针初始可以指向-1，也可以指向0，想一想为什么。</span></span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>初始化时要注意，我们这里返回的是一个 Stack 的指针，引用传递在系统中的开销比较小</p>
<h3 id="栈的基本操作"><a href="#栈的基本操作" class="headerlink" title="栈的基本操作"></a>栈的基本操作</h3><p>对于一个栈来说，其基本操作分为以下四种。</p>
<ul>
<li>Push(e E) , 将一个数据类型为 E 的元素 e 放到栈顶。</li>
<li>Pop() , 将栈顶元素取出。</li>
<li>IsFul() , 栈是否满了。</li>
<li>IsEmpty() , 栈是否空了。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> <span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">int</span>, size),</span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Push</span><span class="params">(e <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.IsFull() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 把盘子摞上去</span></span><br><span class="line">    s.container[s.top] = e</span><br><span class="line">    <span class="comment">// 下一个能摞盘子的位置</span></span><br><span class="line">    s.top++</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Pop</span><span class="params">()</span> <span class="params">(flag <span class="keyword">bool</span>, ret <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 如果栈空了，你就无法拿到新盘子，所以flag此时为false</span></span><br><span class="line">    <span class="keyword">if</span> s.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>, ret</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 取出盘子</span></span><br><span class="line">    ret = s.container[s.top<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// 下一个能取盘子的位置</span></span><br><span class="line">    s.top--</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsFull</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == s.size &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    stack := NewStack(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 先测试栈为空的时候能否Pop</span></span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">    <span class="comment">// 测试Push是否正常</span></span><br><span class="line">    stack.Push(<span class="number">1</span>)</span><br><span class="line">    stack.Push(<span class="number">2</span>)</span><br><span class="line">    stack.Push(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 如果栈为正常的，这里Pop打印顺序应该是3,2,1</span></span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">    fmt.Println(stack.Pop())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="栈的常见应用"><a href="#栈的常见应用" class="headerlink" title="栈的常见应用"></a>栈的常见应用</h3><h4 id="浏览器中的前进后退"><a href="#浏览器中的前进后退" class="headerlink" title="浏览器中的前进后退"></a>浏览器中的前进后退</h4><p>假设你现在是 N 年前的 Chrome 浏览器工程师， 你现在很苦恼，有的网页在打开下一个页面后就回不去上一级了，你现在急迫的想要一个后退的功能，请问要怎么样实现呢？</p>
<p>仔细分析之后不难发现，所谓的后退，撤销等操作，其实就是一个栈的 Pop 操作，我们每次点击的网址, 或者进行的操作，都是被程序 Push 到了一个栈中，所以一旦我们点击撤销或后退时，总是可以返回我们最近一次的操作。这就是栈的最广泛的应用。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">string</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> <span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">string</span>, size),</span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Push</span><span class="params">(e <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.IsFull() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    s.container[s.top] = e</span><br><span class="line">    s.top++</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Pop</span><span class="params">()</span> <span class="params">(flag <span class="keyword">bool</span>, ret <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 如果栈是空的，那么就不能继续 Pop 了</span></span><br><span class="line">    <span class="keyword">if</span> s.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>, ret</span><br><span class="line">    &#125;</span><br><span class="line">    ret = s.container[s.top<span class="number">-1</span>]</span><br><span class="line">    s.top--</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsFull</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == s.size &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    back := NewStack(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 模拟每次点击网页时，浏览器会自push你的网址到栈中</span></span><br><span class="line">    back.Push(<span class="string">"www.baidu.com"</span>)</span><br><span class="line">    back.Push(<span class="string">"www.bing.com"</span>)</span><br><span class="line">    back.Push(<span class="string">"www.goole.com"</span>)</span><br><span class="line">    <span class="comment">// 每次点击后退时，就相当于是从栈中Pop了一个网址</span></span><br><span class="line">    fmt.Println(back.Pop())</span><br><span class="line">    fmt.Println(back.Pop())</span><br><span class="line">    fmt.Println(back.Pop())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="括号匹配"><a href="#括号匹配" class="headerlink" title="括号匹配"></a>括号匹配</h4><p>在现代的 IDE 中，我们的编辑器环境是十分智能的,我少打了一个括号，IDE 就自动给我画了一条红线。是不是非常的神奇。其实这个功能也是用栈实现的。下面来说一下思路：<br>若遇到左括号入栈，遇到右括号时将栈顶左括号出栈，则遍历完所有括号后 stack 仍然为空；如果遍历之后 stack 不为空，那么说明有多余的左括号。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 用来装元素的切片</span></span><br><span class="line">    container []<span class="keyword">byte</span></span><br><span class="line">    <span class="comment">// 栈顶标记位</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// 容量限制</span></span><br><span class="line">    size <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化时，要传入容量限制</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">(size <span class="keyword">int</span>)</span> <span class="title">Stack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stack&#123;</span><br><span class="line">        container: <span class="built_in">make</span>([]<span class="keyword">byte</span>,size),</span><br><span class="line">        top:       <span class="number">0</span>,</span><br><span class="line">        size:      size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Push</span> <span class="params">(e <span class="keyword">byte</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.IsFull() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    s.container[s.top] = e</span><br><span class="line">    s.top++</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Pop</span> <span class="params">()</span> <span class="params">(flag <span class="keyword">bool</span>,ret <span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 如果栈是空的，那么就不能继续 Pop 了</span></span><br><span class="line">    <span class="keyword">if</span> s.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>,ret</span><br><span class="line">    &#125;</span><br><span class="line">    ret = s.container[s.top<span class="number">-1</span>]</span><br><span class="line">    s.top--</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>,ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsEmpty</span> <span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">IsFull</span> <span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.top == s.size &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsValid</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    stack := NewStack(<span class="number">100</span>)</span><br><span class="line">    <span class="comment">// 遍历括号字符串</span></span><br><span class="line">    <span class="keyword">for</span> _,v := <span class="keyword">range</span> s &#123;</span><br><span class="line">        <span class="keyword">if</span> v == <span class="string">'('</span> &#123;</span><br><span class="line">            <span class="comment">// 由于golang中的字符串默认是unicode编码，所以我们要做一个强制类型转换</span></span><br><span class="line">            stack.Push(<span class="keyword">byte</span>(v))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> v == <span class="string">')'</span> &#123;</span><br><span class="line">            <span class="comment">// 如果flag不为true，说明栈已经到底了，可以直返回false</span></span><br><span class="line">            <span class="keyword">if</span> flag,top := stack.Pop(); flag == <span class="literal">true</span> &amp;&amp;top == <span class="string">'('</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 字符串遍历完后如果栈也空了，说明括号匹配</span></span><br><span class="line">    <span class="keyword">if</span> stack.IsEmpty() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果栈不空，说明栈里还有多余的左括号</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    test1 := <span class="string">"()()())"</span></span><br><span class="line">    test2 := <span class="string">"((()"</span></span><br><span class="line">    test3 := <span class="string">"()()()()"</span></span><br><span class="line">    fmt.Println(IsValid(test1))</span><br><span class="line">    fmt.Println(IsValid(test2))</span><br><span class="line">    fmt.Println(IsValid(test3))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/22/go语言将interface变量转换为固定类型的参数/" itemprop="url">
                  go语言将interface变量转换为固定类型的参数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-03-22T23:35:53+08:00" content="2020-03-22">
              2020-03-22
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center"><br>终有一天 我有属于我的天<br></blockquote>

<p>Goのプログラミングでは、どんな型の引数でも受け取れる関数を作るのにinterface{}を使います。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">v</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">  fmt.Println(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// v(1)     =&gt; 1</span></span><br><span class="line"><span class="comment">// v("abc") =&gt; abc</span></span><br></pre></td></tr></table></figure></p>
<p>しかし、interface{}型な変数を、たとえばintを引数にとる関数に渡すと、エラーになります。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125; = <span class="number">1</span></span><br><span class="line">  fmt.Println( add2(x) )</span><br><span class="line">  <span class="comment">//=&gt; cannot use x (type interface &#123;&#125;) as type int in argument to add2: need type assertion</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add2</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n + <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>このようなことをしたい場合は、castするか、switch式を使うことで、型を変換して関数に渡すことができます。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125; = <span class="number">1</span></span><br><span class="line">  <span class="keyword">var</span> y <span class="keyword">interface</span>&#123;&#125; = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// cast</span></span><br><span class="line">  <span class="keyword">if</span> xi, ok := x.(<span class="keyword">int</span>); ok&#123;</span><br><span class="line">    fmt.Println( add2(xi) ) <span class="comment">//=&gt; 3</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//switch</span></span><br><span class="line">  <span class="keyword">switch</span> yi := y.(<span class="keyword">type</span>)&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">    <span class="comment">// ここに入ってきた時は、yiの型はintとして扱われる</span></span><br><span class="line">    fmt.Println( add2(yi) ) <span class="comment">//=&gt; 5</span></span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">int64</span>, <span class="keyword">int32</span>, <span class="keyword">int8</span>:</span><br><span class="line">    <span class="comment">// ここに入ってきた時は、yiの型はint64, int32, int8のうち適切な型が選ばれている</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add2</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n + <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>パッケージ的なものを自作していると、</p>
<ul>
<li>どんな型の変数も渡せる</li>
<li>特定の型の関数を渡せる</li>
</ul>
<p>ような関数が欲しくなることがあります。具体的には以下のように使える関数です</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exec</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  v <span class="keyword">interface</span>&#123;&#125;, // value</span></span></span><br><span class="line"><span class="function"><span class="params">  f <span class="keyword">interface</span>&#123;&#125;, // valueを引数に実行する<span class="keyword">func</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">  fv := reflect.ValueOf(f)</span><br><span class="line">  <span class="keyword">if</span> fv.Kind() != reflect.Func&#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"2'nd argument is not func."</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  rv := reflect.ValueOf(v)</span><br><span class="line">  <span class="keyword">return</span> fv.Call([]reflect.Value&#123;rv&#125;)[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//　以下のように使える</span></span><br><span class="line">exec(<span class="number">5</span>, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123; <span class="keyword">return</span> i * ( i + <span class="number">1</span>) &#125;)</span><br><span class="line">exec(<span class="string">"Tom"</span>, <span class="function"><span class="keyword">func</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span>&#123; <span class="keyword">return</span> <span class="string">"hello! "</span> + s &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一引数と、第二引数の引数の型が違うと、buildはできるが実行時にエラーが起きる</span></span><br><span class="line">exec(<span class="string">"Tom"</span>, <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123; <span class="keyword">return</span> i * ( i + <span class="number">1</span>) &#125;)</span><br></pre></td></tr></table></figure>
<p>build時に、エラーを出してほしいのですが、なかなかそうもいかない…</p>
<blockquote>
<p><a href="https://qiita.com/umanoda/items/07887d33ef1155b26ed2" target="_blank" rel="noopener">https://qiita.com/umanoda/items/07887d33ef1155b26ed2</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/22/golang字符串相关处理/" itemprop="url">
                  golang字符串相关处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-03-22T23:05:09+08:00" content="2020-03-22">
              2020-03-22
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center"><br>琴声何在 生死难猜 用一生去等待<br></blockquote>

<h3 id="文字列を結合する"><a href="#文字列を結合する" class="headerlink" title="文字列を結合する"></a>文字列を結合する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="string">"Hello"</span></span><br><span class="line">    b := a + <span class="string">" World"</span></span><br><span class="line">    fmt.Println(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="繰り返し文字列を生成する"><a href="#繰り返し文字列を生成する" class="headerlink" title="繰り返し文字列を生成する"></a>繰り返し文字列を生成する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"Hey "</span></span><br><span class="line">    fmt.Println(strings.Repeat(s, <span class="number">3</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="大文字・小文字に揃える"><a href="#大文字・小文字に揃える" class="headerlink" title="大文字・小文字に揃える"></a>大文字・小文字に揃える</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"I love GoLang"</span></span><br><span class="line">    fmt.Println(strings.ToUpper(s))</span><br><span class="line">    fmt.Println(strings.ToLower(s))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="大文字と小文字の入れ替え"><a href="#大文字と小文字の入れ替え" class="headerlink" title="大文字と小文字の入れ替え"></a>大文字と小文字の入れ替え</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//うーん、かなりイマイチ</span></span><br><span class="line">    s := <span class="string">"i lOVE gOLANG"</span></span><br><span class="line">    sr := <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> _, x := <span class="keyword">range</span> s &#123;</span><br><span class="line">        xs := <span class="keyword">string</span>(x)</span><br><span class="line">        u := strings.ToUpper(xs)</span><br><span class="line">        l := strings.ToLower(xs)</span><br><span class="line">        <span class="keyword">if</span> u == xs &#123;</span><br><span class="line">            sr += l</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> l == xs &#123;</span><br><span class="line">            sr += u</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sr += xs</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(sr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="コマンドの実行結果を文字列に"><a href="#コマンドの実行結果を文字列に" class="headerlink" title="コマンドの実行結果を文字列に"></a>コマンドの実行結果を文字列に</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"os/exec"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    out, _ := exec.Command(<span class="string">"date"</span>).Output()</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(out))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="複数行の文字列を作成する"><a href="#複数行の文字列を作成する" class="headerlink" title="複数行の文字列を作成する"></a>複数行の文字列を作成する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`</span></span><br><span class="line"><span class="string">    This is a test.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    GoLang, programming language developed at Google.</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ヒアドキュメントの終端文字列をインデントする"><a href="#ヒアドキュメントの終端文字列をインデントする" class="headerlink" title="ヒアドキュメントの終端文字列をインデントする"></a>ヒアドキュメントの終端文字列をインデントする</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> . <span class="string">"github.com/MakeNowJust/heredoc/dot"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := D(<span class="string">`</span></span><br><span class="line"><span class="string">    This is a test.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    GoLang, programming language developed at Google.   </span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="複数行のコマンドの実行結果を文字列に設定する"><a href="#複数行のコマンドの実行結果を文字列に設定する" class="headerlink" title="複数行のコマンドの実行結果を文字列に設定する"></a>複数行のコマンドの実行結果を文字列に設定する</h3><p>exec.Command()を使います。 (echoはシェル組み込みコマンドのせいか実行されない。。)<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"os/exec"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := D(<span class="string">`</span></span><br><span class="line"><span class="string">    date</span></span><br><span class="line"><span class="string">    echo "-----------------------------"</span></span><br><span class="line"><span class="string">    ps</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">    outs := <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> _, s = <span class="keyword">range</span> strings.Split(s, <span class="string">"\n"</span>) &#123;</span><br><span class="line">        out, _ := exec.Command(s).Output()</span><br><span class="line">        outs += <span class="keyword">string</span>(out)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(outs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="部分文字列を取り出す"><a href="#部分文字列を取り出す" class="headerlink" title="部分文字列を取り出す"></a>部分文字列を取り出す</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"Apple Banana Orange"</span></span><br><span class="line">    fmt.Println(s[<span class="number">0</span>:<span class="number">5</span>])       <span class="comment">// =&gt; Apple</span></span><br><span class="line">    fmt.Println(s[<span class="number">6</span>:(<span class="number">6</span> + <span class="number">6</span>)]) <span class="comment">// =&gt; Banana</span></span><br><span class="line">    fmt.Println(s[<span class="number">0</span>:<span class="number">3</span>])       <span class="comment">// =&gt; App</span></span><br><span class="line">    fmt.Println(s[<span class="number">6</span>])         <span class="comment">// =&gt; 66</span></span><br><span class="line">    fmt.Println(s[<span class="number">13</span>:<span class="number">19</span>])     <span class="comment">// =&gt; Orange</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="部分文字列を置き換える"><a href="#部分文字列を置き換える" class="headerlink" title="部分文字列を置き換える"></a>部分文字列を置き換える</h3><p>(うーんいまいち。。)<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"Apple Banana Orange"</span></span><br><span class="line">    ss := strings.Split(s, <span class="string">""</span>)</span><br><span class="line">    srep := strings.Split(<span class="string">"Vine "</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">for</span> i, _ := <span class="keyword">range</span> srep &#123;</span><br><span class="line">        ss[i] = srep[i]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(strings.Join(ss, <span class="string">""</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="文字列中の式を評価し値を展開する"><a href="#文字列中の式を評価し値を展開する" class="headerlink" title="文字列中の式を評価し値を展開する"></a>文字列中の式を評価し値を展開する</h3><p>intなら%dでもよいですが、型推定をよさげに行うのなら%vが使えます。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    value := <span class="number">123</span></span><br><span class="line">    fmt.Printf(<span class="string">"value is %v\n"</span>, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="文字列を1文字ずつ処理する"><a href="#文字列を1文字ずつ処理する" class="headerlink" title="文字列を1文字ずつ処理する"></a>文字列を1文字ずつ処理する</h3><p>こちらによると、 string[n]だとbyte単位、rangeで回すとrune(utf-8文字)単位らしいです。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    sum := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, c := <span class="keyword">range</span> <span class="string">"Golang"</span> &#123;</span><br><span class="line">        sum = sum + <span class="keyword">int</span>(c)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="文字列の先頭と末尾の空白文字を削除する"><a href="#文字列の先頭と末尾の空白文字を削除する" class="headerlink" title="文字列の先頭と末尾の空白文字を削除する"></a>文字列の先頭と末尾の空白文字を削除する</h3><p>空白ならTrimSpace, 任意の文字でやりたければTrimでやれます。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"   Hello, Golang!   "</span></span><br><span class="line">    s = strings.TrimSpace(s)</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="文字列を整数に変換する-to-i"><a href="#文字列を整数に変換する-to-i" class="headerlink" title="文字列を整数に変換する (to_i)"></a>文字列を整数に変換する (to_i)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i := <span class="number">1</span></span><br><span class="line">    s := <span class="string">"999"</span></span><br><span class="line">    si, _ := strconv.Atoi(s)</span><br><span class="line">    i = i + si</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列を浮動小数点に変換する-to-f"><a href="#文字列を浮動小数点に変換する-to-f" class="headerlink" title="文字列を浮動小数点に変換する (to_f)"></a>文字列を浮動小数点に変換する (to_f)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"10"</span></span><br><span class="line">    sf, _ := strconv.ParseFloat(s, <span class="number">64</span>) <span class="comment">//64 bit float</span></span><br><span class="line">    fmt.Println(sf)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8進文字列を整数に変換する"><a href="#8進文字列を整数に変換する" class="headerlink" title="8進文字列を整数に変換する"></a>8進文字列を整数に変換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"010"</span></span><br><span class="line">    so, _ := strconv.ParseInt(s, <span class="number">8</span>, <span class="number">64</span>) <span class="comment">// base 8, 64bit</span></span><br><span class="line">    fmt.Println(so)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16進文字列を整数に変換する"><a href="#16進文字列を整数に変換する" class="headerlink" title="16進文字列を整数に変換する"></a>16進文字列を整数に変換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"ff"</span> <span class="comment">// 0xは含んではいけません。</span></span><br><span class="line">    sh, _ := strconv.ParseInt(s, <span class="number">16</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(sh)</span><br><span class="line"></span><br><span class="line">    s = <span class="string">"0xff"</span> <span class="comment">// 0xを含んでも良い</span></span><br><span class="line">    sh, _ = strconv.ParseInt(s, <span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(sh)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ASCII文字をコード値に（コード値をASCII文字に）変換する"><a href="#ASCII文字をコード値に（コード値をASCII文字に）変換する" class="headerlink" title="ASCII文字をコード値に（コード値をASCII文字に）変換する"></a>ASCII文字をコード値に（コード値をASCII文字に）変換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"ABC"</span></span><br><span class="line">    fmt.Println(s[<span class="number">0</span>])</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(<span class="number">82</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`		</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 文字列を中央寄せ・左詰・右詰する</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//右詰、左詰めはformat文字列が対応しています。±で指定。</span></span><br><span class="line">    s := <span class="string">"Go"</span></span><br><span class="line">    fmt.Printf(<span class="string">"%10s\n"</span>, s)</span><br><span class="line">    fmt.Printf(<span class="string">"%-10s\n"</span>, s)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//センタリングはなさそうです。</span></span><br><span class="line">    l := <span class="number">10</span></span><br><span class="line">    ls := (l - <span class="built_in">len</span>(s)) / <span class="number">2</span></span><br><span class="line">    cs := strings.Repeat(<span class="string">" "</span>, ls) + s + strings.Repeat(<span class="string">" "</span>, l-(ls+<span class="built_in">len</span>(s)))</span><br><span class="line">    fmt.Println(cs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="“次”の文字列を取得する"><a href="#“次”の文字列を取得する" class="headerlink" title="“次”の文字列を取得する"></a>“次”の文字列を取得する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(succ(<span class="string">"9"</span>))    <span class="comment">// =&gt; "10"</span></span><br><span class="line">    fmt.Println(succ(<span class="string">"a"</span>))    <span class="comment">// =&gt; "b"</span></span><br><span class="line">    fmt.Println(succ(<span class="string">"AAA"</span>))  <span class="comment">// =&gt; "AAB"</span></span><br><span class="line">    fmt.Println(succ(<span class="string">"A99"</span>))  <span class="comment">// =&gt; "B00"</span></span><br><span class="line">    fmt.Println(succ(<span class="string">"A099"</span>)) <span class="comment">// =&gt; "A100"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文字列を反転して返す</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    ans := <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i, _ := <span class="keyword">range</span> s &#123;</span><br><span class="line">        ans += <span class="keyword">string</span>(s[<span class="built_in">len</span>(s)-i<span class="number">-1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(ans)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "次"の文字列を取得する</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">succ</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    r := reverse(s)</span><br><span class="line">    ans := <span class="string">""</span></span><br><span class="line">    carry := <span class="number">1</span></span><br><span class="line">    lastLetter := <span class="keyword">string</span>(r[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i, _ := <span class="keyword">range</span> r &#123;</span><br><span class="line">        lastLetter = <span class="keyword">string</span>(r[i])</span><br><span class="line">        a := lastLetter</span><br><span class="line">        <span class="keyword">if</span> carry == <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> lastLetter == <span class="string">"z"</span> &#123;</span><br><span class="line">                a = <span class="string">"a"</span></span><br><span class="line">                carry = <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">"Z"</span> &#123;</span><br><span class="line">                a = <span class="string">"A"</span></span><br><span class="line">                carry = <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">"9"</span> &#123;</span><br><span class="line">                a = <span class="string">"0"</span></span><br><span class="line">                carry = <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> r[i] == <span class="number">0</span> &#123;</span><br><span class="line">                    a = <span class="string">"1"</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    a = <span class="keyword">string</span>(r[i] + <span class="number">1</span>)</span><br><span class="line">                    carry = <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> carry == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> lastLetter == <span class="string">"9"</span> &#123;</span><br><span class="line">            ans += <span class="string">"1"</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">"z"</span> &#123;</span><br><span class="line">            ans += <span class="string">"a"</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> lastLetter == <span class="string">"Z"</span> &#123;</span><br><span class="line">            ans += <span class="string">"A"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> reverse(ans)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列を暗号化する"><a href="#文字列を暗号化する" class="headerlink" title="文字列を暗号化する"></a>文字列を暗号化する</h3><p>とりあえずMD5あたりの例を書いておきます。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span>     <span class="string">"crypto/md5"</span></span><br><span class="line"><span class="keyword">import</span>     <span class="string">"io"</span></span><br><span class="line"><span class="keyword">import</span>     <span class="string">"bufio"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    h := md5.New()</span><br><span class="line">    io.WriteString(h, <span class="string">"hogehoge"</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Print(<span class="string">"input password &gt;"</span>)</span><br><span class="line">    scanner := bufio.NewScanner(os.Stdin)</span><br><span class="line">    scanner.Scan()</span><br><span class="line"></span><br><span class="line">    h2 := md5.New()</span><br><span class="line">    io.WriteString(h2, scanner.Text())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> h2.Sum(<span class="literal">nil</span>)[<span class="number">0</span>] == h.Sum(<span class="literal">nil</span>)[<span class="number">0</span>] &#123;</span><br><span class="line">        fmt.Println(<span class="string">"right"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"wrong"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="文字列中で指定したパターンにマッチする部分を置換する"><a href="#文字列中で指定したパターンにマッチする部分を置換する" class="headerlink" title="文字列中で指定したパターンにマッチする部分を置換する"></a>文字列中で指定したパターンにマッチする部分を置換する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"Apple Banana Apple Orange"</span></span><br><span class="line">    s = strings.Replace(s, <span class="string">"Apple"</span>, <span class="string">"Pine"</span>, <span class="number">1</span>) <span class="comment">// 最後の引数は回数</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">    s = strings.Replace(s, <span class="string">"Apple"</span>, <span class="string">"Pine"</span>, <span class="number">-1</span>) <span class="comment">// &lt;0で無制限</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列中に含まれている任意文字列の位置を求める"><a href="#文字列中に含まれている任意文字列の位置を求める" class="headerlink" title="文字列中に含まれている任意文字列の位置を求める"></a>文字列中に含まれている任意文字列の位置を求める</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"Apple Banana Apple Orange"</span></span><br><span class="line">    fmt.Println(strings.Index(s, <span class="string">"Apple"</span>))  <span class="comment">// =&gt; 0</span></span><br><span class="line">    fmt.Println(strings.Index(s, <span class="string">"Banana"</span>)) <span class="comment">// =&gt; 6</span></span><br><span class="line">    <span class="comment">// 途中から検索する方法は無いのでスライスで渡す</span></span><br><span class="line">    fmt.Println(strings.Index(s[<span class="number">6</span>:], <span class="string">"Apple"</span>) + <span class="number">6</span>) <span class="comment">// =&gt; 13</span></span><br><span class="line">    <span class="comment">// 後方検索はLastIndex()</span></span><br><span class="line">    fmt.Println(strings.LastIndex(s, <span class="string">"Apple"</span>))          <span class="comment">// =&gt; 13</span></span><br><span class="line">    fmt.Println(strings.Index(s[:(<span class="built_in">len</span>(s)<span class="number">-6</span>)], <span class="string">"Apple"</span>)) <span class="comment">// =&gt; 0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文字列の末端の改行を削除する"><a href="#文字列の末端の改行を削除する" class="headerlink" title="文字列の末端の改行を削除する"></a>文字列の末端の改行を削除する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"Hello, Golang!\n"</span></span><br><span class="line">    s = strings.TrimRight(s, <span class="string">"\n"</span>)</span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="カンマ区切りの文字列を扱う"><a href="#カンマ区切りの文字列を扱う" class="headerlink" title="カンマ区切りの文字列を扱う"></a>カンマ区切りの文字列を扱う</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    s := <span class="string">"001,ASHITANI Tatsuji,Yokohama"</span></span><br><span class="line">    slice := strings.Split(s, <span class="string">","</span>)</span><br><span class="line">    <span class="keyword">for</span> _, x := <span class="keyword">range</span> slice &#123;</span><br><span class="line">        fmt.Println(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="任意のパターンにマッチするものを全て抜き出す"><a href="#任意のパターンにマッチするものを全て抜き出す" class="headerlink" title="任意のパターンにマッチするものを全て抜き出す"></a>任意のパターンにマッチするものを全て抜き出す</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"regexp"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"hoge:045-111-2222 boke:045-222-2222"</span></span><br><span class="line">    re, _ := regexp.Compile(<span class="string">"(\\S+):([\\d\\-]+)"</span>)</span><br><span class="line">    ans := re.FindAllStringSubmatch(s, <span class="number">-1</span>) <span class="comment">// [マッチした全体,１個目のカッコ,２個目のカッコ,..]の配列</span></span><br><span class="line">    fmt.Println(ans)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="漢字コードを変換する"><a href="#漢字コードを変換する" class="headerlink" title="漢字コードを変換する"></a>漢字コードを変換する</h3><p>下記はEUCの例です。 指定するコーディングは、EUCJP,ISO2022JP,ShiftJISのどれかです。<br>こちらでご指摘いただいた点を 修正しました。’EUCJP’は’japanese.EUCJP’と呼びます。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/text/encoding/japanese"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/text/transform"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"strings"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"io"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"os"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"bytes"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    KconvFwrite()     <span class="comment">// ファイル書き込み</span></span><br><span class="line">    KconvFread()      <span class="comment">// ファイル読み出し</span></span><br><span class="line">    KconvToBuffer()   <span class="comment">// バッファに書き込み</span></span><br><span class="line">    KconvFromBuffer() <span class="comment">// バッファから読み出し</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ファイル書き込み</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvFwrite</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"漢字です"</span> <span class="comment">// UTF8</span></span><br><span class="line">    f, _ := os.Create(<span class="string">"EUC.txt"</span>)</span><br><span class="line">    r := strings.NewReader(s)</span><br><span class="line">    w := transform.NewWriter(f, japanese.EUCJP.NewEncoder()) <span class="comment">// Encoder-&gt;f</span></span><br><span class="line">    io.Copy(w, r)                                            <span class="comment">// r -&gt; w(-&gt;Encoder-&gt;f)</span></span><br><span class="line">    f.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ファイル読み出し</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvFread</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, _ := os.Open(<span class="string">"EUC.txt"</span>)</span><br><span class="line">    b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    r := transform.NewReader(f, japanese.EUCJP.NewDecoder()) <span class="comment">// f -&gt; Decoder</span></span><br><span class="line">    io.Copy(b, r)                                            <span class="comment">// (f-&gt;Decoder)-&gt;b</span></span><br><span class="line">    fmt.Println(b.String())</span><br><span class="line">    f.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// バッファに書き込み</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvToBuffer</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"漢字です"</span> <span class="comment">// UTF8</span></span><br><span class="line">    b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    r := strings.NewReader(s)</span><br><span class="line">    w := transform.NewWriter(b, japanese.EUCJP.NewEncoder()) <span class="comment">// Encoder-&gt;f</span></span><br><span class="line">    io.Copy(w, r)                                            <span class="comment">// r -&gt; w(-&gt;Encoder-&gt;f)</span></span><br><span class="line"></span><br><span class="line">    st := b.String()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(st); i++ &#123;</span><br><span class="line">        fmt.Println(st[i])</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(b.String())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// バッファから読み出し</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KconvFromBuffer</span><span class="params">()</span></span> &#123;</span><br><span class="line">    str_bytes := []<span class="keyword">byte</span>&#123;<span class="number">180</span>, <span class="number">193</span>, <span class="number">187</span>, <span class="number">250</span>, <span class="number">164</span>, <span class="number">199</span>, <span class="number">164</span>, <span class="number">185</span>&#125;</span><br><span class="line">    s := bytes.NewBuffer(str_bytes).String() <span class="comment">// "漢字です" in EUC</span></span><br><span class="line"></span><br><span class="line">    sr := strings.NewReader(s)</span><br><span class="line">    b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    r := transform.NewReader(sr, japanese.EUCJP.NewDecoder()) <span class="comment">// sr -&gt; Decoder</span></span><br><span class="line">    io.Copy(b, r)                                             <span class="comment">// (sr-&gt;Decoder)-&gt;b</span></span><br><span class="line">    fmt.Println(b.String())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="マルチバイト文字の数を数える"><a href="#マルチバイト文字の数を数える" class="headerlink" title="マルチバイト文字の数を数える"></a>マルチバイト文字の数を数える</h3><p>こちらが詳しいです。 len()だとbyteカウント、[]runeに変換するとutf-8カウント。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"日本語"</span></span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(s))         <span class="comment">// =&gt; 9</span></span><br><span class="line">    fmt.Println(<span class="built_in">len</span>([]<span class="keyword">rune</span>(s))) <span class="comment">// =&gt; 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="マルチバイト文字列の最後の1文字を削除する"><a href="#マルチバイト文字列の最後の1文字を削除する" class="headerlink" title="マルチバイト文字列の最後の1文字を削除する"></a>マルチバイト文字列の最後の1文字を削除する</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">"日本語"</span></span><br><span class="line">    sc := []<span class="keyword">rune</span>(s)</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(sc[:(<span class="built_in">len</span>(sc) - <span class="number">1</span>)])) <span class="comment">// =&gt; "日本"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://ashitani.jp/golangtips/tips_string.html#string_Split" target="_blank" rel="noopener">https://ashitani.jp/golangtips/tips_string.html#string_Split</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/16/go读写csv文件/" itemprop="url">
                  go读写csv文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-03-16T21:18:44+08:00" content="2020-03-16">
              2020-03-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center"><br>我害怕，看到你，独自一人绝望；<br>更害怕，看不到你，不能和你一起迷惘……<br></blockquote>

<p>go言語の encoding/csv パッケージの使い方。<br>CSVファイルの読み書きと、オプション、エラーハンドリングについて書いてます。</p>
<h3 id="一行ずつ読み込む-Read"><a href="#一行ずつ読み込む-Read" class="headerlink" title="一行ずつ読み込む(Read)"></a>一行ずつ読み込む(Read)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// recordは配列</span></span><br><span class="line">        fmt.Printf(<span class="string">"%#v\n"</span>, record)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// []string&#123;"名前", "年齢", "身長", "体重"&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;"Tanaka", "31", "190cm", "97kg"&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;"Suzuki", "46", "180cm", "79kg"&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;"Matsui", "45", "188cm", "95kg"&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ファイルから読み込む"><a href="#ファイルから読み込む" class="headerlink" title="ファイルから読み込む"></a>ファイルから読み込む</h3><p>ファイルから読み込む場合は <code>csv.NewReader</code> に <code>*os.File</code> を渡す</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">"file.csv"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r := csv.NewReader(f)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(record)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="csv-Readerのオプション"><a href="#csv-Readerのオプション" class="headerlink" title="csv.Readerのオプション"></a>csv.Readerのオプション</h3><blockquote>
<p>Comma: 区切り文字を変更<br>Comment: コメント行の先頭になる文字を指定<br>FieldsPerRecord: 各行のフィールド数を指定<br>LazyQuotes: ダブルクオートを厳密にチェックするかどうか<br>TrimLeadingSpace: 先頭の空白文字を無視する<br>ReuseRecord: スライスの再利用<br>TrailingComma: Deprecated(非推奨)</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前;年齢;身長;体重</span></span><br><span class="line"><span class="string"># コメント行</span></span><br><span class="line"><span class="string">Tanaka;31;190cm;97kg</span></span><br><span class="line"><span class="string"># コメント行</span></span><br><span class="line"><span class="string">Suzuki;46;180cm;79kg</span></span><br><span class="line"><span class="string"># コメント行</span></span><br><span class="line"><span class="string">Matsui;45;188cm;95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line">    r.Comma = <span class="string">';'</span> <span class="comment">// 区切り文字を , から ; に変更</span></span><br><span class="line">    r.Comment = <span class="string">'#'</span> <span class="comment">// 先頭が # の場合はコメント行として扱う</span></span><br><span class="line">    r.FieldsPerRecord = <span class="number">4</span> <span class="comment">// 各行のフィールド数。多くても少なくてもエラーになる</span></span><br><span class="line">    r.LazyQuotes = <span class="literal">true</span> <span class="comment">// true の場合、"" が値の途中に "180"cm のようになっていてもエラーにならない</span></span><br><span class="line">    r.TrimLeadingSpace = <span class="literal">true</span> <span class="comment">// true の場合は、先頭の空白文字を無視する</span></span><br><span class="line">    r.ReuseRecord = <span class="literal">true</span> <span class="comment">// true の場合は、Read で戻ってくるスライスを次回再利用する。パフォーマンスが上がる</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// recordは配列</span></span><br><span class="line">        fmt.Printf(<span class="string">"%#v\n"</span>, record)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// []string&#123;"名前", "年齢", "身長", "体重"&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;"Tanaka", "31", "190cm", "97kg"&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;"Suzuki", "46", "180cm", "79kg"&#125;</span></span><br><span class="line">        <span class="comment">// []string&#123;"Matsui", "45", "188cm", "95kg"&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="エラーハンドリング-csv-ParseError"><a href="#エラーハンドリング-csv-ParseError" class="headerlink" title="エラーハンドリング(csv.ParseError)"></a>エラーハンドリング(csv.ParseError)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    records, err := r.ReadAll()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> e, ok := err.(*csv.ParseError); ok &#123;</span><br><span class="line">            n := <span class="number">0</span></span><br><span class="line">            <span class="keyword">switch</span> e.Err &#123;</span><br><span class="line">            <span class="keyword">case</span> csv.ErrBareQuote:</span><br><span class="line">                <span class="comment">// ダブルクオート途中で使用されていて LazyQuotes を true にしていない場合のエラー</span></span><br><span class="line">                <span class="comment">// 例えば、 Tan"aka,31,190cm,97kg のように 途中に " がある場合</span></span><br><span class="line">                n = <span class="number">1</span></span><br><span class="line">            <span class="keyword">case</span> csv.ErrQuote:</span><br><span class="line">                <span class="comment">// 先頭がダブルクオートで始まっていて、末尾がダブルクオートになっていない場合のエラー</span></span><br><span class="line">                <span class="comment">// 例えば、 "Tanaka,31,190cm,97kg のように閉じるための " がない場合</span></span><br><span class="line">                n = <span class="number">2</span></span><br><span class="line">            <span class="keyword">case</span> csv.ErrFieldCount:</span><br><span class="line">                <span class="comment">// FieldsPerRecordで指定した数と異なる場合のエラー</span></span><br><span class="line">                n = <span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">            log.Fatal(<span class="string">"\nエラー: "</span>, n, <span class="string">"\n"</span>, e.Err,</span><br><span class="line">                <span class="string">"\nStartLine:"</span>, e.StartLine, <span class="string">"\nLine:"</span>, e.Line, <span class="string">"\nColumn:"</span>, e.Column)</span><br><span class="line">        &#125;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(records)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="読み込んだShift-JISファイルをUTF8にする"><a href="#読み込んだShift-JISファイルをUTF8にする" class="headerlink" title="読み込んだShift-JISファイルをUTF8にする"></a>読み込んだShift-JISファイルをUTF8にする</h3><p><code>encoding/japanese</code> と <code>text/transform</code> が必要なのでダウンロードする</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> get golang.org/x/text/encoding/japanese golang.org/x/text/transform</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"golang.org/x/text/encoding/japanese"</span></span><br><span class="line">    <span class="string">"golang.org/x/text/transform"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f, err := os.Open(<span class="string">"file-sjis.csv"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r := csv.NewReader(transform.NewReader(f, japanese.ShiftJIS.NewDecoder()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fmt.Println(record)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="一度にすべて読み込む-ReadAll"><a href="#一度にすべて読み込む-ReadAll" class="headerlink" title="一度にすべて読み込む(ReadAll)"></a>一度にすべて読み込む(ReadAll)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    record, err := r.ReadAll()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">"%#v\n"</span>, record)</span><br><span class="line">    <span class="comment">// [][]string&#123;</span></span><br><span class="line">    <span class="comment">//     []string&#123;"名前", "年齢", "身長", "体重"&#125;,</span></span><br><span class="line">    <span class="comment">//     []string&#123;"Tanaka", "31", "190cm", "97kg"&#125;,</span></span><br><span class="line">    <span class="comment">//     []string&#123;"Suzuki", "46", "180cm", "79kg"&#125;,</span></span><br><span class="line">    <span class="comment">//     []string&#123;"Matsui", "45", "188cm", "95kg"&#125;,</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="一行ずつ書き込む-Write"><a href="#一行ずつ書き込む-Write" class="headerlink" title="一行ずつ書き込む(Write)"></a>一行ずつ書き込む(Write)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    records := [][]<span class="keyword">string</span>&#123;</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"名前"</span>, <span class="string">"年齢"</span>, <span class="string">"身長"</span>, <span class="string">"体重"</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"Tanaka"</span>, <span class="string">"31"</span>, <span class="string">"190cm"</span>, <span class="string">"97kg"</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"Suzuki"</span>, <span class="string">"46"</span>, <span class="string">"180cm"</span>, <span class="string">"79kg"</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"Matsui"</span>, <span class="string">"45"</span>, <span class="string">"188cm"</span>, <span class="string">"95kg"</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    f, err := os.Create(<span class="string">"file.csv"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w := csv.NewWriter(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// オプション</span></span><br><span class="line">    w.Camma = <span class="string">','</span> <span class="comment">// デフォルトはカンマ区切りで出力される。変更する場合はこの rune 文字を変更する</span></span><br><span class="line">    w.UseCRLF = <span class="literal">true</span> <span class="comment">// 改行文字を CRLF(\r\n) にする</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, record := <span class="keyword">range</span> records &#123;</span><br><span class="line">        <span class="keyword">if</span> err := w.Write(record); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w.Flush() <span class="comment">// バッファに残っているデータをすべて書き込む</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := w.Error(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>書き込み結果<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat file.csv</span><br><span class="line">名前,年齢,身長,体重</span><br><span class="line">Tanaka,<span class="number">31</span>,<span class="number">190</span>cm,<span class="number">97</span>kg</span><br><span class="line">Suzuki,<span class="number">46</span>,<span class="number">180</span>cm,<span class="number">79</span>kg</span><br><span class="line">Matsui,<span class="number">45</span>,<span class="number">188</span>cm,<span class="number">95</span>kg</span><br></pre></td></tr></table></figure></p>
<h3 id="すべて一度に書き込む-WriteAll"><a href="#すべて一度に書き込む-WriteAll" class="headerlink" title="すべて一度に書き込む(WriteAll)"></a>すべて一度に書き込む(WriteAll)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    records := [][]<span class="keyword">string</span>&#123;</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"名前"</span>, <span class="string">"年齢"</span>, <span class="string">"身長"</span>, <span class="string">"体重"</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"Tanaka"</span>, <span class="string">"31"</span>, <span class="string">"190cm"</span>, <span class="string">"97kg"</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"Suzuki"</span>, <span class="string">"46"</span>, <span class="string">"180cm"</span>, <span class="string">"79kg"</span>&#125;,</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">"Matsui"</span>, <span class="string">"45"</span>, <span class="string">"188cm"</span>, <span class="string">"95kg"</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    f, err := os.Create(<span class="string">"file.csv"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w := csv.NewWriter(f)</span><br><span class="line"></span><br><span class="line">    w.WriteAll(records)</span><br><span class="line"></span><br><span class="line">    w.Flush()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := w.Error(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CSVを構造体にマッピングする"><a href="#CSVを構造体にマッピングする" class="headerlink" title="CSVを構造体にマッピングする"></a>CSVを構造体にマッピングする</h3><p>以下のように書いてみたけど、reflect 使うとさらに面倒そう。<br>なので gocsv (gocsvのgodocページ) を使えば、読み込んだCSVを構造体にマッピングできて、 その逆で構造体からCSVに変換するのも楽にできそう。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/csv"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name   <span class="keyword">string</span></span><br><span class="line">    Age    <span class="keyword">int</span></span><br><span class="line">    Height <span class="keyword">string</span></span><br><span class="line">    Weight <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    s := <span class="string">`名前,年齢,身長,体重</span></span><br><span class="line"><span class="string">Tanaka,31,190cm,97kg</span></span><br><span class="line"><span class="string">Suzuki,46,180cm,79kg</span></span><br><span class="line"><span class="string">Matsui,45,188cm,95kg</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    r := csv.NewReader(strings.NewReader(s))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> p []People</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; ; i++ &#123;</span><br><span class="line">        record, err := r.Read()</span><br><span class="line">        <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> people People</span><br><span class="line">        <span class="keyword">for</span> i, v := <span class="keyword">range</span> record &#123;</span><br><span class="line">            <span class="keyword">switch</span> i &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                people.Name = v</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                people.Age, err = strconv.Atoi(v)</span><br><span class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                    log.Fatal(err)</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                people.Height = v</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                people.Weight = v</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        p = <span class="built_in">append</span>(p, people)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://golang.hateblo.jp/entry/golang-encoding-csv" target="_blank" rel="noopener">https://golang.hateblo.jp/entry/golang-encoding-csv</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/13/理解laravel的管道/" itemprop="url">
                  理解laravel的管道
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-03-13T17:18:06+08:00" content="2020-03-13">
              2020-03-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center"><br>当我们搬开别人架下的绊脚石时，也许恰恰是在为自己铺路。<br></blockquote>

<p>Basically, using laravel pipelines you can pass an object between several classes in a fluid way to perform any type of task and finally return the resulting value once all the “tasks” have been executed.</p>
<p>The most clear example about how pipelines works resides in one of the most used components of the framework itself. I’m talking about middlewares.</p>
<p>Middleware provide a convenient mechanism for filtering HTTP requests entering your application… This is how a basic middleware looks like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">app(Pipeline::class)</span><br><span class="line">    -&gt;send($content)</span><br><span class="line">    -&gt;through($pipes)</span><br><span class="line">    -&gt;via(‘customMethodName’) <span class="comment">// &lt;---- This one :)</span></span><br><span class="line">    -&gt;then(<span class="function"><span class="keyword">function</span> <span class="params">($content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Post::create([<span class="string">'content'</span> =&gt; $content]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>These “middlewares” are in fact just pipes by where the request is going to be sent thru, in order to perform any needed task. Here you can check if the request is an HTTP request, a JSON request, if there is any user authenticated, etc.</p>
<p>If you take a quick look to the <code>Illuminate\Foundation\Http\Kernel</code> class, you’ll see how the middlewares are executed by using a new instance of the Pipeline class.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Send the given request through the middleware / router.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">sendRequestThroughRouter</span><span class="params">($request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;instance(<span class="string">'request'</span>, $request);</span><br><span class="line">    Facade::clearResolvedInstance(<span class="string">'request'</span>);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;bootstrap();</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> Pipeline(<span class="keyword">$this</span>-&gt;app))</span><br><span class="line">                    -&gt;send($request)</span><br><span class="line">                    -&gt;through(<span class="keyword">$this</span>-&gt;app-&gt;shouldSkipMiddleware() ? [] : <span class="keyword">$this</span>-&gt;middleware)</span><br><span class="line">    -&gt;then(<span class="keyword">$this</span>-&gt;dispatchToRouter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can read in the code something like: a new pipeline that sends the request through a list of middlewares and then dispatch the router.</p>
<p>Don’t worry if this seems a little overwhelmed to you. Let’s try to clarify the concept with the follow example.</p>
<h3 id="Working-on-a-class-that-requires-to-run-multiple-tasks"><a href="#Working-on-a-class-that-requires-to-run-multiple-tasks" class="headerlink" title="Working on a class that requires to run multiple tasks"></a>Working on a class that requires to run multiple tasks</h3><p>Consider this situation. Let’s say you are building a forum where people can create threads and leave comments. But your client ask you to auto-remove tags or edit them on every piece of content when it’s created.</p>
<p>So this is what you are asked to do:</p>
<ul>
<li>Replace link tags with plain text.</li>
<li>Replace bad words with “*”</li>
<li>Remove script tags entirely from the content</li>
</ul>
<p>Probably you end up creating classes to handle each of these “tasks”.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$pipes = [</span><br><span class="line">    RemoveBadWords::class</span><br><span class="line">    ReplaceLinkTags::clas</span><br><span class="line">    RemoveScriptTags::class</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>What we are going to do is to pass the given “content” to each task and then return the result to the next one. We can do this using a pipeline.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $pipes = [</span><br><span class="line">        RemoveBadWords::class,</span><br><span class="line">        ReplaceLinkTags::clas,</span><br><span class="line">        RemoveScriptTags::class</span><br><span class="line">    ];</span><br><span class="line">    $post = app(Pipeline::class)</span><br><span class="line">        -&gt;send($request-&gt;content)</span><br><span class="line">        -&gt;through($pipes)</span><br><span class="line">        -&gt;then(<span class="function"><span class="keyword">function</span> <span class="params">($content)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Post::create([<span class="string">'content'</span> =&gt; <span class="string">'content'</span>]);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">// return any type of response</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Each “task” class should have a “handle” method to perform the action. Maybe it would be a good idea to have a contract to be implemented by each class:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Pipe</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($content, Closure $next)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoveBadWords</span> <span class="keyword">implements</span> <span class="title">Pipe</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($content, Closure $next)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Here you perform the task and return the updated $content</span></span><br><span class="line">        <span class="comment">// to the next pipe</span></span><br><span class="line">        <span class="keyword">return</span>  $next($content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The method used to perform the task should receive two parameters, the first one would be the passable object, and the second one would be a closure where the object is going to be redirected to after running the last pipe.</p>
<p>You can use a custom method name instead of ‘handle’. Then you need to specify the method name to be used by the pipeline, like so</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">app(Pipeline::class)</span><br><span class="line">    -&gt;send($content)</span><br><span class="line">    -&gt;through($pipes)</span><br><span class="line">    -&gt;via(‘customMethodName’) <span class="comment">// &lt;---- This one :)</span></span><br><span class="line">    -&gt;then(<span class="function"><span class="keyword">function</span> <span class="params">($content)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Post::create([<span class="string">'content'</span> =&gt; $content]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="What-happens-at-the-end"><a href="#What-happens-at-the-end" class="headerlink" title="What happens at the end ?"></a>What happens at the end ?</h3><p>What should happen here is that the post content is going to be modified by each one of the <code>$pipes</code> and at the end, this resulting content is going to be stored.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$post = app(Pipeline::class)</span><br><span class="line">    -&gt;send($request-&gt;all())</span><br><span class="line">    -&gt;through($pipes)</span><br><span class="line">    -&gt;then(<span class="function"><span class="keyword">function</span> <span class="params">($content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Post::create([<span class="string">'content'</span> =&gt; $content]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Final-words"><a href="#Final-words" class="headerlink" title="Final words"></a>Final words</h3><p>Remember, there are tons of ways you can approach this type of issues. What you decide to do it’s up to you. But it is good to know that you have this tool in your arsenal to be used if necessary. I hope this example gives you a better understanding of what these “laravel pipelines” are and how to use them. You can also take a look at api laravel documents if you want to know more about how this</p>
<blockquote>
<p><a href="https://jeffochoa.me/understanding-laravel-pipelines" target="_blank" rel="noopener">https://jeffochoa.me/understanding-laravel-pipelines</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/73/">73</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="lnmput@gmail.com">
          <p class="site-author-name" itemprop="name">lnmput@gmail.com</p>
          <p class="site-description motion-element" itemprop="description">一个专注记录外贸网站开发技术栈的个人博客</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">365</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">141</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lnmput" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.laruence.com/" title="风雪之隅" target="_blank">风雪之隅</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://tech.youzan.com/" title="有赞技术团队" target="_blank">有赞技术团队</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://tech.meituan.com/archives" title="美团点评技术团队" target="_blank">美团点评技术团队</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://macshuo.com/" title="點燈坊" target="_blank">點燈坊</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.turn.tw/" title="轉個彎日誌" target="_blank">轉個彎日誌</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lnmput@gmail.com</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
